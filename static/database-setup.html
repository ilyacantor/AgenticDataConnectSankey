<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Setup - DCL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .step-box {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .code-block {
            background: #0f172a;
            border: 1px solid #1e293b;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: #94a3b8;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .copy-btn {
            background: #0891b2;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }
        .copy-btn:hover {
            background: #0e7490;
        }
        .step-number {
            background: #0891b2;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }
    </style>
</head>
<body class="bg-slate-950 text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-cyan-500 mb-2">üîß Database Setup Guide</h1>
            <p class="text-slate-400">Follow these simple steps to set up authentication</p>
        </div>

        <!-- Step 1 -->
        <div class="step-box">
            <div class="flex items-start mb-4">
                <div class="step-number">1</div>
                <div>
                    <h2 class="text-xl font-semibold text-white mb-2">Open Supabase SQL Editor</h2>
                    <p class="text-slate-400 mb-4">Go to your Supabase Dashboard and click on "SQL Editor" in the left sidebar</p>
                    <a href="https://supabase.com/dashboard" target="_blank" class="copy-btn inline-block">
                        Open Supabase Dashboard ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="step-box">
            <div class="flex items-start mb-4">
                <div class="step-number">2</div>
                <div class="flex-1">
                    <h2 class="text-xl font-semibold text-white mb-2">Run This SQL Code</h2>
                    <p class="text-slate-400 mb-4">Click "New query" in SQL Editor, then copy and paste this code:</p>
                    
                    <div class="relative">
                        <button onclick="copySQL()" class="copy-btn absolute top-2 right-2">üìã Copy Code</button>
                        <div class="code-block" id="sqlCode">-- Create user_profiles table
CREATE TABLE IF NOT EXISTS public.user_profiles (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE NOT NULL,
  role TEXT NOT NULL CHECK (role IN ('admin', 'viewer')) DEFAULT 'viewer',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Users can view own profile" 
  ON public.user_profiles FOR SELECT 
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own profile" 
  ON public.user_profiles FOR INSERT 
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own profile" 
  ON public.user_profiles FOR UPDATE 
  USING (auth.uid() = user_id)
  WITH CHECK (auth.uid() = user_id);

-- Create auto-profile function
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.user_profiles (user_id, role)
  VALUES (NEW.id, 'viewer');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Create trigger
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

-- Performance index
CREATE INDEX IF NOT EXISTS idx_user_profiles_user_id ON public.user_profiles(user_id);

-- Grant permissions
GRANT USAGE ON SCHEMA public TO anon, authenticated;
GRANT SELECT, INSERT, UPDATE ON public.user_profiles TO authenticated;</div>
                    </div>
                    <p class="text-slate-400 mt-4 text-sm">After pasting, click the "Run" button to execute the code</p>
                </div>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="step-box">
            <div class="flex items-start mb-4">
                <div class="step-number">3</div>
                <div>
                    <h2 class="text-xl font-semibold text-white mb-2">Sign Up</h2>
                    <p class="text-slate-400 mb-4">Return to the login page and create your first account</p>
                    <a href="/#/login" class="copy-btn inline-block">Go to Login Page ‚Üí</a>
                </div>
            </div>
        </div>

        <!-- Step 4 -->
        <div class="step-box">
            <div class="flex items-start mb-4">
                <div class="step-number">4</div>
                <div class="flex-1">
                    <h2 class="text-xl font-semibold text-white mb-2">Make Yourself Admin</h2>
                    <p class="text-slate-400 mb-4">After signing up, go back to Supabase SQL Editor and run this (replace with your email):</p>
                    
                    <div class="relative">
                        <button onclick="copyAdmin()" class="copy-btn absolute top-2 right-2">üìã Copy Code</button>
                        <div class="code-block" id="adminCode">UPDATE public.user_profiles 
SET role = 'admin' 
WHERE user_id = (SELECT id FROM auth.users WHERE email = 'your-email@example.com');</div>
                    </div>
                    <p class="text-slate-400 mt-4 text-sm">‚ö†Ô∏è Remember to replace 'your-email@example.com' with the email you used to sign up!</p>
                </div>
            </div>
        </div>

        <div class="text-center mt-8">
            <div class="bg-green-900/20 border border-green-700/50 rounded-lg p-4 inline-block">
                <p class="text-green-400">‚úÖ That's it! Your authentication system is ready to use</p>
            </div>
        </div>
    </div>

    <script>
        function copySQL() {
            const code = document.getElementById('sqlCode').textContent;
            navigator.clipboard.writeText(code);
            const btn = event.target;
            const original = btn.textContent;
            btn.textContent = '‚úÖ Copied!';
            setTimeout(() => btn.textContent = original, 2000);
        }

        function copyAdmin() {
            const code = document.getElementById('adminCode').textContent;
            navigator.clipboard.writeText(code);
            const btn = event.target;
            const original = btn.textContent;
            btn.textContent = '‚úÖ Copied!';
            setTimeout(() => btn.textContent = original, 2000);
        }
    </script>
</body>
</html>
